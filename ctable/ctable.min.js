"use strict";function TextRender(elem,record,column){elem.text(record.record_field(column))}function HTMLRender(elem,record,column){elem.html(record.record_field(column))}function EmptyRender(elem,record,column){}class CColumn{constructor(table,record,options={}){this.table=table;this.record=record;this.options=options;this.title_elem=null;this.options_elem=null;this.cell_elem=null;this.editor_elem=null;this.summary_elem=null;this.editor=null;if(typeof this.options.render!="undefined"){this.render=this.options.render}else{this.render=TextRender}}visible_column(){if(typeof this.options.visible_column!="undefined"){return this.options.visible_column}return true}visible_editor(){if(typeof this.options.visible_editor!="undefined"){return this.options.visible_editor}return true}width(){if(typeof this.options.width!="undefined"){return this.options.width}return 0}build_title(elem){this.title_elem=elem;if(typeof this.options.title!="undefined"){this.title_elem.text(this.options.title)}}build_options(elem){this.options_elem=elem}build_cell(elem){this.cell_elem=elem;if(typeof this.options.max_width!="undefined"){this.cell_elem.css({"max-width":this.options.max_width+"px"})}if(typeof this.options.break_words!="undefined"&&this.options.break_words){this.cell_elem.css({"word-wrap":"break-word"})}this.render(elem,this.record,this.options.column)}build_editor(elem,is_new_record=false){this.editor_elem=elem;this.editor=$('<input class="input"></input>').appendTo(this.editor_elem);if(is_new_record){this.editor.val("")}else{this.editor.val(this.record.record_field(this.options.column))}this.editor.change($.proxy(this.value_changed,this))}build_summary(elem){this.summary_elem=elem}value_changed(){if(typeof this.options.column!="undefined"&&this.is_valid()){this.record.on_change_in_editor(this.options.column,this.editor.val())}}is_valid(){return true}record_changed(column_name,value){}editor_value(){if(typeof this.options.column=="undefined"){return[null,null]}if(typeof this.options.virtual!="undefined"&&this.options.virtual){return[null,null]}if(this.editor!=null){return[this.options.column,this.editor.val()]}else{if(!this.record.record_is_new()){return[this.options.column,this.record.record_field(this.options.column)]}}return[null,null]}}class CTextColumn extends CColumn{constructor(table,record,options={}){super(table,record,options);this.sort_button=null;this.search_field=null}build_title(elem){this.title_elem=elem;if(typeof this.options.title!="undefined"){this.title_elem.text(this.options.title)}if(typeof this.options.no_sort=="undefined"||!this.options.no_sort){this.sort_button=$('<a class="icon" title="'+this.table.lang.sort_tooltip+'"><span class="unicode-icon ctable-sort-none">⇵</span><span class="unicode-icon ctable-sort-up" style="display: none;">↑</span><span class="unicode-icon ctable-sort-down" style="display: none;">↓</span></a>').prependTo(this.title_elem);this.sort_button.click($.proxy(this.sort_button_click,this))}}sort_button_click(){if(this.sort_button.find("span.ctable-sort-none").css("display")!="none"){this.sort_button.find("span.ctable-sort-none").css("display","none");this.sort_button.find("span.ctable-sort-up").css("display","");this.table.set_order(this.options.column,"ASC");this.table.select();return}if(this.sort_button.find("span.ctable-sort-up").css("display")!="none"){this.sort_button.find("span.ctable-sort-up").css("display","none");this.sort_button.find("span.ctable-sort-down").css("display","");this.table.set_order(this.options.column,"DESC");this.table.select();return}if(this.sort_button.find("span.ctable-sort-down").css("display")!="none"){this.sort_button.find("span.ctable-sort-down").css("display","none");this.sort_button.find("span.ctable-sort-none").css("display","");this.table.set_order(this.options.column,"");this.table.select();return}}build_options(elem){this.options_elem=elem;if(typeof this.options.no_search=="undefined"||!this.options.no_search){this.search_field=$('<input class="input" type="search"></input>').appendTo(this.options_elem);this.search_field.change($.proxy(this.set_search_filter,this))}}set_search_filter(){this.table.set_search(this.options.column,this.search_field.val());this.table.select()}is_valid(){if(typeof this.options.validate!="undefined"&&this.editor!=null){var re=new RegExp(this.options.validate);if(!re.test(this.editor.val())){this.editor.removeClass("is-success");this.editor.addClass("is-danger");return false}else{this.editor.removeClass("is-danger");this.editor.addClass("is-success");return true}}return true}build_editor(elem,is_new_record=false){this.editor_elem=elem;if(typeof this.options.input!="undefined"&&this.options.input=="textarea"){this.editor=$('<textarea class="textarea"></textarea>').appendTo(this.editor_elem)}else{this.editor=$('<input class="input"></input>').appendTo(this.editor_elem)}if(is_new_record){if(typeof this.options.default_value!="undefined"){this.editor.val(this.options.default_value)}else{this.editor.val("")}}else{this.editor.val(this.record.record_field(this.options.column))}this.editor.change($.proxy(this.value_changed,this))}}class CDateTimePickerColumn extends CTextColumn{build_options(elem){super.build_options(elem);if(typeof this.options.no_search!="undefined"&&this.options.no_search){return}if(typeof this.options.no_picker_for_options!="undefined"&&this.options.no_picker_for_options){return}if(typeof this.options.datetimepicker!="undefined"){this.search_field.datetimepicker(this.options.datetimepicker)}else{this.search_field.datetimepicker()}}build_editor(elem,is_new_record=false){super.build_editor(elem,is_new_record);if(typeof this.options.datetimepicker!="undefined"){this.editor.datetimepicker(this.options.datetimepicker)}else{this.editor.datetimepicker()}}}class CSelectColumn extends CTextColumn{constructor(table,record,options={}){super(table,record,options);if(typeof this.options.endpoint!="undefined"){if(typeof this.options.params=="undefined"){this.options.params={}}this.table.load_from_options_cache(this.options.endpoint,this.options.params,$.proxy(this.fill_options,this))}}fill_options(options){this.options.options=options;if(this.cell_elem!=null){for(var opt in this.options.options){if(this.options.options[opt][0]==this.record.record_field(this.options.column)){this.cell_elem.text(this.options.options[opt][1])}}}if(this.editor_elem!=null){this.editor.empty();for(var opt in this.options.options){var selected="";if(!this.record.record_is_new()&&this.record.record_field(this.options.column)==this.options.options[opt][0]){selected="selected"}$('<option value="'+this.options.options[opt][0]+'" '+selected+">"+this.options.options[opt][1]+"</option>").appendTo(this.editor)}}if(this.options_elem!=null){for(var opt in this.options.options){$('<option value="'+this.options.options[opt][0]+'">'+this.options.options[opt][1]+"</option>").appendTo(this.search_field)}}}build_cell(elem){this.cell_elem=elem;if(typeof this.options.options!="undefined"){for(var opt in this.options.options){if(this.options.options[opt][0]==this.record.record_field(this.options.column)){this.cell_elem.text(this.options.options[opt][1])}}}}build_editor(elem,is_new_record=false){this.editor_elem=elem;var div_select=$('<div class="select"></div>').appendTo(this.editor_elem);this.editor=$("<select></select>").appendTo(div_select);if(is_new_record){if(typeof this.options.default_value=="undefined"||typeof this.options.options=="undefined"){$('<option value="" selected>'+this.table.lang.no_select+"</option>").appendTo(this.editor)}}if(typeof this.options.options!="undefined"){for(var opt in this.options.options){var selected="";if(!this.record.record_is_new()&&this.record.record_field(this.options.column)==this.options.options[opt][0]){selected="selected"}if(this.record.record_is_new()&&this.options.default_value==this.options.options[opt][0]){selected="selected"}$('<option value="'+this.options.options[opt][0]+'" '+selected+">"+this.options.options[opt][1]+"</option>").appendTo(this.editor)}}this.editor.change($.proxy(this.value_changed,this))}build_options(elem){this.options_elem=elem;if(typeof this.options.no_filter=="undefined"||!this.options.no_filter){var div_select=$('<div class="select" style="max-width: 10em;"></div>').appendTo(this.options_elem);this.search_field=$("<select></select>").appendTo(div_select);$('<option value="%any" selected>'+this.table.lang.no_select+"</option>").appendTo(this.search_field);if(typeof this.options.options!="undefined"){for(var opt in this.options.options){$('<option value="'+this.options.options[opt][0]+'">'+this.options.options[opt][1]+"</option>").appendTo(this.search_field)}}this.search_field.change($.proxy(this.set_search_filter,this))}}set_search_filter(){this.table.set_filter(this.options.column,this.search_field.val());this.table.select()}is_valid(){if(typeof this.options.validate!="undefined"&&this.editor!=null){if(this.editor.val()==""){this.editor.parent().removeClass("is-success");this.editor.parent().addClass("is-danger");return false}else{this.editor.parent().removeClass("is-danger");this.editor.parent().addClass("is-success");return true}}return true}}class CSelect2Column extends CSelectColumn{build_editor(elem,is_new_record=false){super.build_editor(elem,is_new_record);if(typeof this.options.multiple!="undefined"&&this.options.multiple){this.editor.prop("multiple","multiple")}if(typeof this.options.select2!="undefined"){this.editor.select2(this.options.select2)}else{this.editor.select2()}}build_options(elem){super.build_options(elem);if(typeof this.options.no_filter!="undefined"&&this.options.no_filter){return}if(typeof this.options.no_select2_for_options!="undefined"&&this.options.no_select2_for_options){return}if(typeof this.options.select2!="undefined"){this.search_field.select2(this.options.select2)}else{this.search_field.select2()}}}class CCommandColumn extends CColumn{constructor(table,record,options={}){super(table,record,options);this.new_record=null;this.edit_record=null;this.show_editor_button=null;this.new_record_button=null}build_new_record_editor(){if(this.new_record!==null){this.new_record.row.remove();this.new_record=null;if(this.new_record_button!==null){this.new_record_button.children("a").addClass("is-outlined")}}else{this.new_record=new this.table.record_class(this.table,this.record_options);var editor_row=$("<tr></tr>").prependTo(this.table.tbody);this.new_record.set_row(editor_row);this.new_record.set_data_index(this.record.data_index);this.new_record.set_parent_column(this);this.new_record.build_editor(true);if(this.new_record_button!==null){this.new_record_button.children("a").removeClass("is-outlined")}}}build_title(elem){this.title_elem=elem;var buttons_div=$('<div class="field has-addons" style="justify-content: right;"></div>').appendTo(this.title_elem);if(typeof this.options.no_add=="undefined"||this.options.no_add==false){this.new_record_button=$('<p class="control"><a class="button is-info is-outlined" title="'+this.table.lang.add_tooltip+'"><span class="icon is-small"><span class="unicode-icon">⊕</span></span></a></p>').appendTo(buttons_div).click($.proxy(this.build_new_record_editor,this))}if(typeof this.options.no_refresh=="undefined"||this.options.no_refresh==false){$('<p class="control"><a class="button is-info is-outlined" title="'+this.table.lang.reload_tooltip+'"><span class="icon is-small"><span class="unicode-icon">↻</span></span></a></p>').appendTo(buttons_div).click($.proxy(this.refresh_table,this))}if(typeof this.options.common_actions!="undefined"){for(var i in this.options.common_actions){var bstyle="is-info is-outlined";var symbol="○";if(typeof this.options.common_actions[i].button_class!="undefined"){bstyle=this.options.common_actions[i].button_class}if(typeof this.options.common_actions[i].symbol!="undefined"){symbol=this.options.common_actions[i].symbol}$('<p class="control"><a class="button '+bstyle+'" title="'+this.options.common_actions[i].tooltip+'"><span class="icon is-small"><span class="unicode-icon">'+symbol+"</span></span></a></p>").appendTo(buttons_div).click($.proxy(function(i){this.options.common_actions[i].action(this.record)},this,i))}}}open_edit_record_editor(){this.show_editor_button.children("a").removeClass("is-outlined");this.show_editor_button.off("click");this.show_editor_button.click($.proxy(this.close_edit_record_editor,this));this.edit_record=new this.table.record_class(this.table,this.record_options);var editor_row=this.record.open_subrecord($.proxy(this.close_editor,this));this.edit_record.set_row(editor_row);this.edit_record.set_data_index(this.record.data_index);this.edit_record.set_parent_column(this);this.edit_record.build_editor()}close_edit_record_editor(){this.show_editor_button.children("a").addClass("is-outlined");this.show_editor_button.off("click");this.show_editor_button.click($.proxy(this.open_edit_record_editor,this));this.record.close_subrecord();this.edit_record=null}build_cell(elem){this.cell_elem=elem;var buttons_div=$('<div class="field has-addons" style="justify-content: right;"></div>').appendTo(this.cell_elem);if(typeof this.options.no_edit=="undefined"||this.options.no_edit==false){this.show_editor_button=$('<p class="control"><a class="button is-warning is-outlined" title="'+this.table.lang.edit_tooltip+'"><span class="icon is-small"><span class="unicode-icon">✎</span></span></a></p>').appendTo(buttons_div).click($.proxy(this.open_edit_record_editor,this))}if(typeof this.options.no_delete=="undefined"||this.options.no_delete==false){$('<p class="control"><a class="button is-danger is-outlined" title="'+this.table.lang.delete_tooltip+'"><span class="icon is-small"><span class="unicode-icon">⊗</span></span></a></p>').appendTo(buttons_div).click($.proxy(this.delete_record,this))}if(typeof this.options.item_actions!="undefined"){for(var i in this.options.item_actions){var bstyle="is-info is-outlined";var symbol="○";if(typeof this.options.item_actions[i].button_class!="undefined"){bstyle=this.options.item_actions[i].button_class}if(typeof this.options.item_actions[i].symbol!="undefined"){symbol=this.options.item_actions[i].symbol}$('<p class="control"><a class="button '+bstyle+'" title="'+this.options.item_actions[i].tooltip+'"><span class="icon is-small"><span class="unicode-icon">'+symbol+"</span></span></a></p>").appendTo(buttons_div).click($.proxy(function(i){this.options.item_actions[i].action(this.record)},this,i))}}}close_editor(){if(this.edit_record!==null){this.close_edit_record_editor()}if(this.record.parent_column!==null){if(this.record.parent_column.edit_record!==null){this.record.parent_column.close_edit_record_editor()}if(this.record.parent_column.new_record!==null){this.record.parent_column.new_record.row.remove();this.record.parent_column.new_record=null;this.record.parent_column.new_record_button.children("a").addClass("is-outlined")}}}visible_column(){return true}visible_editor(){return true}build_editor(elem,is_new_record=false){this.editor_elem=elem;var buttons_div=$('<div class="field is-grouped"></div>').appendTo(this.editor_elem);if(typeof this.options.no_commit=="undefined"||this.options.no_commit==false){if(is_new_record){$('<p class="control"><a class="button is-primary is-outlined"><span class="file-icon"><span class="unicode-icon">⊕</span></span>&nbsp;'+this.table.lang.add_record+"</a></p>").appendTo(buttons_div).click($.proxy(this.add_record,this))}else{$('<p class="control"><a class="button is-primary is-outlined"><span class="file-icon"><span class="unicode-icon">⊕</span></span>&nbsp;'+this.table.lang.save_record+"</a></p>").appendTo(buttons_div).click($.proxy(this.save_record,this))}}if(typeof this.options.no_cancel=="undefined"||this.options.no_cancel==false){$('<a class="button is-warning is-outlined"><span class="file-icon"><span class="unicode-icon">⊗</span></span>&nbsp;'+this.table.lang.cancel+"</a>").appendTo(buttons_div).click($.proxy(this.close_editor,this))}}add_record(){if(this.table.insert(this.record)!="invalid"){this.close_editor()}}save_record(){this.table.update(this.record)}delete_record(){if(confirm(this.table.lang.delete_confirm)){this.table.remove(this.record)}}refresh_table(){this.table.select()}}function CExportTableAction(table,format,filename,header={}){return{symbol:"↧",action:function(record){record.table.download(format,filename,header)},tooltip:table.lang.export}}class CCustomColumn extends CColumn{constructor(table,record,options={}){super(table,record,options)}build_cell(elem){super.build_cell(elem);if(typeof this.options.text!="undefined"){elem.text(this.options.text(this,this.record,this.options.column));return}if(typeof this.options.html!="undefined"){elem.html(this.options.html(this,this.record,this.options.column));return}}visible_column(){return true}visible_editor(){return false}}class CMultiColumn extends CColumn{constructor(table,record,options={}){super(table,record,options);if(!("columns_options"in this.options)){this.options.columns_options={}}if(!("columns_endpoints"in this.options)){this.options.columns_endpoints={}}if(!("columns_params"in this.options)){this.options.columns_params={}}for(var i in this.options.columns_endpoints){this.table.load_from_options_cache(this.options.columns_endpoints[i],this.options.columns_params[i],$.proxy(this.fill_options,this,i))}}fill_options(colname,options){this.options.columns_options[colname]=options;if(this.cell_elem!=null){this.build_cell(this.cell_elem)}}build_cell(elem){super.build_cell(elem);this.cell_elem=elem;var dt_style="";if(typeof this.options.labels_width!="undefined"){dt_style=' style="width:'+this.options.labels_width+';" '}var text="";for(var i in this.options.columns){var cell_value=this.record.record_field(this.options.columns[i]);if(this.options.columns[i]in this.options.columns_options){for(var k in this.options.columns_options[this.options.columns[i]]){if(this.options.columns_options[this.options.columns[i]][k][0]==cell_value)cell_value=this.options.columns_options[this.options.columns[i]][k][1]}}else{if(this.options.columns[i]in this.options.columns_endpoints){cell_value=""}}text+="<dt"+dt_style+"> "+this.options.labels[i]+": </dt><dd>"+cell_value+"</dd>"}elem.html("<dl>"+text+"</dl>")}build_options(elem){this.options_elem=elem;if(typeof this.options.no_search=="undefined"||!this.options.no_search){this.search_field=$('<input class="input" type="search"></input>').appendTo(this.options_elem);this.search_field.change($.proxy(this.set_search_filter,this))}}set_search_filter(){if(typeof this.options.search_columns=="undefined"){this.table.set_search(this.options.columns.join("+"),this.search_field.val())}else{this.table.set_search(this.options.search_columns.join("+"),this.search_field.val())}this.table.select()}visible_column(){return true}visible_editor(){return false}}class CIndicatorColumn extends CCustomColumn{constructor(table,record,options={}){super(table,record,options);options.html=function(self,record,column_name){var state=self.options.informer(record,column_name);if(state==""||state=="none"){return""}if(state=="primary"){return'<a class="button is-primary is-outlined"><span class="unicode-icon">○</span></a>'}if(state=="info"){return'<a class="button is-info is-outlined"><span class="unicode-icon">⊙</span></a>'}if(state=="success"||state=="ok"){return'<a class="button is-success is-outlined"><span class="unicode-icon">⊕</span></a>'}if(state=="warning"){return'<a class="button is-warning is-outlined"><span class="unicode-icon">⊘</span></a>'}if(state=="danger"||state=="error"){return'<a class="button is-danger is-outlined"><span class="unicode-icon">⊗</span></a>'}}}}class CCheckboxColumn extends CColumn{constructor(table,record,options={}){super(table,record,options);this.checkbox_row=null;this.checkbox_head=null}is_selected(){return this.checkbox_row.prop("checked")}build_cell(elem){super.build_cell(elem);elem.html('<label class="checkbox"><input type="checkbox" class="checkbox-column-sel"></label>');this.checkbox_row=elem.find("input")}build_options(elem){super.build_options(elem);elem.html('<label class="checkbox" title="'+this.table.lang.select_all_tooltip+'"><input type="checkbox"></label>');this.checkbox_head=elem.find("input");this.checkbox_head.change(function(){$(".checkbox-column-sel").prop("checked",this.checked)})}visible_column(){return true}visible_editor(){return false}}function file_name_shortifier(fname,length){if(fname.length<=length){return fname}return fname.substring(0,length-5)+"&hellip;"+fname.substring(fname.length-5)}function cfileupload_default_parser(column,record,value){if(value==""||value==null){return{uploaded:false,count:0,filelabel:"",uid:"",filelink:"",filedate:""}}var flines=value.split(";").filter(function(el){return el.length!=0});if(flines.length==1){var fcomp=flines[0].split(":");return{uploaded:true,count:1,filelabel:file_name_shortifier(fcomp[1],column.options.filelabel_length),uid:fcomp[0],filelink:column.options.link_endpoint+fcomp[0]}}var uids=[];var labels=[];var links=[];flines.forEach(function(frecord){var fcomp=frecord.split(":").filter(function(el){return el.length!=0});uids.push(fcomp[0]);labels.push(file_name_shortifier(fcomp[1],column.options.filelabel_length));links.push(column.options.link_endpoint+fcomp[0])});return{uploaded:true,count:flines.length,filelabel:labels,uid:uids,filelink:links}}class CFileUploadColumn extends CColumn{constructor(table,record,options={}){super(table,record,options);if(typeof this.options.field_parser=="undefined"){this.options.field_parser=cfileupload_default_parser}if(typeof this.options.filelabel_length=="undefined"){this.options.filelabel_length=12}if(typeof this.options.links=="undefined"){this.options.links=true}this.value=null}build_cell(elem){super.build_cell(elem);this.value=this.record.record_field(this.options.column);var fileinfo=this.options.field_parser(this,this.record,this.value);if(fileinfo.uploaded&&fileinfo.count==1){var filelink="";if(this.options.links){filelink='href="'+fileinfo.filelink+'" target="_blank"'}elem.html('<a class="button is-info is-outlined" '+filelink+'><span class="file-icon"><span class="unicode-icon">⊕</span></span>'+fileinfo.filelabel+"</a>")}else if(fileinfo.uploaded&&fileinfo.count>1){var filelink="";if(this.options.links){filelink='href="'+fileinfo.filelink+'" target="_blank"'}elem.html('<a class="button is-info is-outlined" '+filelink+'><span class="file-icon"><span class="unicode-icon">⊕</span></i></span>'+this.table.lang.multiple+fileinfo.count+"</a>")}else{elem.html('<a class="button is-info is-outlined" disabled><span class="file-icon"><span class="unicode-icon">⊖</span></span>'+this.table.lang.no_file+"</a>")}}build_editor(elem,is_new_record){super.build_editor(elem,is_new_record);this.value="";if(!is_new_record){this.value=this.record.record_field(this.options.column)}this.input_elem=elem.html("<div></div>").find("div").first();this.make_input(this.input_elem,this.value)}make_input(elem,files){var fileinfo=this.options.field_parser(this,this.record,files);var multiple="";if(typeof this.options.multiple!="undefined"&&this.options.multiple){multiple="multiple"}if(fileinfo.uploaded&&fileinfo.count==1){var filelink="";if(this.options.links){filelink='href="'+fileinfo.filelink+'" target="_blank"'}elem.html('<div class="field has-addons"><p class="control"><a class="button is-info is-outlined" '+filelink+'><span class="file-icon"><span class="unicode-icon">⊕</span></span>'+fileinfo.filelabel+'</a></p><p class="control"><a class="button is-info is-outlined ctable-close is-danger"><span class="unicode-icon">⊗</span></a></p><p class="control"><a class="button is-info is-outlined"><span class="unicode-icon">↥</span></a><input class="file-input button" type="file" name="file" '+multiple+"/></p></div>")}else if(fileinfo.uploaded&&fileinfo.count>1){var filelink="";if(this.options.links){filelink='href="'+fileinfo.filelink+'" target="_blank"'}elem.html('<div class="field has-addons"><p class="control"><a class="button is-info is-outlined" '+filelink+'><span class="file-icon"><span class="unicode-icon">⊕</span></span>'+this.table.lang.multiple+fileinfo.count+'</a></p><p class="control"><a class="button is-info is-outlined ctable-close is-danger"><span class="unicode-icon">⊗</span></a></p><p class="control"><a class="button is-info is-outlined"><span class="unicode-icon">↥</span></a><input class="file-input" type="file" name="file" '+multiple+"/></p></div>")}else{elem.html('<div class="field has-addons"><p class="control"><a class="button is-info is-outlined" href="#" disabled><span class="file-icon"><span class="unicode-icon">⊖</span></span>'+this.table.lang.no_file+'</a></p><p class="control"><a class="button is-info is-outlined"><span class="unicode-icon">↥</span></a><input class="file-input" type="file" name="file" '+multiple+"/></p></div>")}var self=this;elem.find(".ctable-close").click(function(){self.value="";self.make_input(self.input_elem,self.value)});elem.find("input").change(function(){var file_data=$(this).prop("files");var form_data=new FormData;for(var file_index=0;file_index<file_data.length;file_index++){form_data.append("file"+file_index,file_data[file_index])}elem.find("a").first().addClass("is-loading");$.ajax({url:self.options.upload_endpoint,dataType:"script",cache:false,contentType:false,processData:false,data:form_data,type:"post",dataType:"json"}).done(function(data){elem.find("a").first().removeClass("is-loading");if(data.Result=="OK"){self.value=data.Files;self.make_input(self.input_elem,self.value)}else{self.options.error_handler(self.table.lang.error+data.Message)}}).fail(function(xhr,status,error){self.table.options.error_handler(self.table.lang.server_side_error+":\n"+xhr.status+": "+xhr.statusText+"\n"+error);elem.find("a").first().removeClass("is-loading")})})}editor_value(){if(typeof this.options.column=="undefined"){return[null,null]}if(typeof this.options.virtual!="undefined"&&this.options.virtual){return[null,null]}if(this.editor!=null){return[this.options.column,this.value]}else{if(!this.record.record_is_new()){return[this.options.column,this.value]}}return[null,null]}is_valid(){if(typeof this.options.validate!="undefined"&&this.options.validate){if(this.value!=""){this.input_elem.find("a").removeClass("is-danger");this.input_elem.find("a").addClass("is-success");return true}this.input_elem.find("a").removeClass("is-success");this.input_elem.find("a").addClass("is-danger");return false}return true}}class CSubtableColumn extends CColumn{constructor(table,record,options={}){super(table,record,options);this.show_subtable_button=null;this.hide_subtable_button=null;this.subtable_row=null;this.subtable_cell=null;this.subtable=null}visible_column(){return true}visible_editor(){return false}build_cell(elem){this.cell_elem=elem;this.show_subtable_button=$('<a class="button is-info is-outlined" title="'+this.table.lang.expand_tooltip+'"><span class="unicode-icon">⊞</span></a>').appendTo(this.cell_elem).click($.proxy(this.open_subtable,this));this.hide_subtable_button=$('<a class="button is-info" style="display:none;"><span class="unicode-icon">⊟</span></a>').appendTo(this.cell_elem).click($.proxy(this.close_subtable,this))}open_subtable(){this.show_subtable_button.hide();this.hide_subtable_button.show();var subtable_row=this.record.open_subrecord($.proxy(this.close_subtable,this));this.subtable_cell=$('<td class="ctable-container-1" colspan="'+this.table.visible_columns()+'"></td>').appendTo(subtable_row);this.subtable=this.options.table(this.record);this.subtable.build_table(this.subtable_cell);this.subtable.select()}close_subtable(){this.record.close_subrecord();this.subtable=null;this.show_subtable_button.show();this.hide_subtable_button.hide()}}class CRecord{constructor(table,options={}){this.table=table;this.options=options;this.columns=[];this.data_index=-1;this.parent_column=null;this.row=null;this.subrecord_row=null;this.subrecord_close_handler=null;for(var i in this.table.columns_classes){this.columns.push(new this.table.columns_classes[i](this.table,this,this.table.columns_options[i]))}}set_head(thead){this.thead=thead;this.header_row=$("<tr></tr>").appendTo(this.thead);this.options_row=$("<tr></tr>").appendTo(this.thead)}set_colgroup(colgroup){this.colgroup=colgroup}set_foot(tfoot){this.tfoot=tfoot;this.footer_row=$("<tr></tr>").appendTo(this.tfoot)}set_parent_column(column){this.parent_column=column}set_row(row){this.row=row}set_data_index(index){this.data_index=index}record_field(field=null){if(field==null){return this.table.data[this.data_index]}return this.table.data[this.data_index][field]}is_selected(){var result=false;this.columns.forEach(function(column){if(typeof column.is_selected!="undefined"){result=column.is_selected();return}});return result}record_is_new(){return this.data_index==-1}build_header(){for(var i in this.columns){if(this.columns[i].visible_column()){if(this.columns[i].width()!=0){$('<col style="width: '+this.columns[i].width()+';"></col>').appendTo(this.colgroup)}else{$("<col></col>").appendTo(this.colgroup)}var head_cell=$("<th></th>").appendTo(this.header_row);this.columns[i].build_title(head_cell);var options_cell=$("<th></th>").appendTo(this.options_row);this.columns[i].build_options(options_cell)}}}build_footer(){for(var i in this.columns){if(this.columns[i].visible_column()){var summary_cell=$("<th></th>").appendTo(this.footer_row);this.columns[i].build_summary(summary_cell)}}}build_record(){for(var i in this.columns){if(this.columns[i].visible_column()){var data_cell=$("<td></td>").appendTo(this.row);this.columns[i].build_cell(data_cell)}}if(typeof this.options.on_build_record!="undefined"){this.options.on_build_record(this.row,this.record_field())}}build_editor(is_new_record=false){for(var i in this.columns){if(this.columns[i].visible_column()&&this.columns[i].visible_editor()){var editor_cell=$("<td></td>").appendTo(this.row);this.columns[i].build_editor(editor_cell,is_new_record)}}for(var i in this.columns){var col_val=this.columns[i].editor_value();for(var j in this.columns){this.columns[j].record_changed(col_val[0],col_val[1])}}}open_subrecord(close_handler){if(this.subrecord_row!=null){this.close_subrecord()}this.subrecord_row=$("<tr></tr>").insertAfter(this.row);this.row.addClass("is-selected");this.subrecord_close_handler=close_handler;return this.subrecord_row}close_subrecord(){if(this.subrecord_row!=null){this.subrecord_row.remove();this.subrecord_row=null;this.row.removeClass("is-selected");if(this.subrecord_close_handler!=null){this.subrecord_close_handler();this.subrecord_close_handler=null}}}on_change_in_editor(column_name,value){for(var i in this.columns){this.columns[i].record_changed(column_name,value)}}editor_values(){var record={};for(var i in this.columns){if(!this.columns[i].is_valid())return null;var[column,value]=this.columns[i].editor_value();if(column!=null){record[column]=value}}return record}}class CAdaptiveRecord extends CRecord{build_record(){if(typeof this.options.adaptive_record!="undefined"||!this.options.adaptive_record){super.build_record();return}var record_row=$('<td colspan="'+this.table.visible_columns()+'"></td>').appendTo(this.row);var record_cell=$('<div class="columns is-multiline"></div>').appendTo(record_row);var width_class="is-4";if(typeof this.options.record_width_class!="undefined"){width_class=this.options.record_width_class}for(var i in this.columns){if(this.columns[i].visible_column()){var column_width_class=width_class;if(typeof this.columns[i].options.record_width_class!="undefined"){column_width_class=this.columns[i].options.record_width_class}var rightfloat="";if(typeof this.columns[i].save_record!="undefined"){rightfloat="float: right;"}var data_cell=$('<div class="column '+column_width_class+'" style="display: inline-block; vertical-align:top;'+rightfloat+'"></div>').appendTo(record_cell);this.columns[i].build_cell(data_cell);if(typeof this.columns[i].options.title!="undefined"){var lab=$('<label class="label"></label>').prependTo(data_cell);lab.text(this.columns[i].options.title+":")}}}if(typeof this.options.on_build_record!="undefined"){this.options.on_build_record(this.row,this.record_field())}}build_editor(is_new_record=false){if(typeof this.options.non_adaptive_editor!="undefined"&&this.options.non_adaptive_editor){super.build_editor(is_new_record);return}var editor_row=$('<td class="ctable-container" colspan="'+this.table.visible_columns()+'"></td>').appendTo(this.row);var editor_cell=$('<div class="columns is-multiline"></div>').appendTo(editor_row);var width_class="is-4";if(typeof this.options.editor_width_class!="undefined"){width_class=this.options.editor_width_class}for(var i in this.columns){var column_width_class=width_class;if(typeof this.columns[i].options.editor_width_class!="undefined"){column_width_class=this.columns[i].options.editor_width_class}if(this.columns[i].visible_editor()){var div=$('<div class="field column '+column_width_class+'"></div>').appendTo(editor_cell);this.columns[i].build_editor(div,is_new_record);if(typeof this.columns[i].options.title!="undefined"){var lab=$('<label class="label"></label>').prependTo(div);lab.text(this.columns[i].options.title+":")}if(typeof this.columns[i].options.footnote!="undefined"){var footnote=$('<p class="is-size-7 has-text-grey-light"></p>').appendTo(div);footnote.text(this.columns[i].options.footnote)}}}for(var i in this.columns){var col_val=this.columns[i].editor_value();for(var j in this.columns){if(col_val[0]!=null){this.columns[j].record_changed(col_val[0],col_val[1])}}}}build_header(){if(typeof this.options.adaptive_record!="undefined"||!this.options.adaptive_record){super.build_header();return}var head_row=$('<th colspan="'+this.table.visible_columns()+'"></th>').appendTo(this.header_row);var options_row=$('<th colspan="'+this.table.visible_columns()+'"></th>').appendTo(this.options_row);var head_div=$('<div class="columns is-multiline"></div>').appendTo(head_row);var options_div=$('<div class="columns is-multiline"></div>').appendTo(options_row);for(var i in this.columns){if(this.columns[i].visible_column()){if(this.columns[i].width()!=0){$('<col style="width: '+this.columns[i].width()+';"></col>').appendTo(this.colgroup)}else{$("<col></col>").appendTo(this.colgroup)}var head_cell=$('<div class="column"></div>').appendTo(head_div);this.columns[i].build_title(head_cell);var options_cell=$('<div class="column"></div>').appendTo(options_div);this.columns[i].build_options(options_cell)}}}}class CPagination{constructor(table,options={}){this.table=table;this.options=options;this.container=null;this.page_selector=null;this.page_size_selector=null;this.page_info=null;this.table.start_record=0;this.table.page_size=25}go_first(){this.table.start_record=0;this.table.select()}go_prev(){this.table.start_record=this.table.start_record-this.table.page_size;if(this.table.start_record<0){this.table.start_record=0}this.table.select()}page_change(){this.table.start_record=parseInt(this.page_selector.val())*this.table.page_size;this.table.select()}go_next(){this.table.start_record=this.table.start_record+this.table.page_size;if(this.table.start_record>=this.table.total_records_count){this.table.start_record=~~(this.table.total_records_count/this.table.page_size)*this.table.page_size}this.table.select()}go_last(){this.table.start_record=~~(this.table.total_records_count/this.table.page_size)*this.table.page_size;this.table.select()}page_size_change(){this.table.page_size=parseInt(this.page_size_selector.val());this.table.start_record=0;this.table.select()}on_table_reloaded(){this.page_selector.empty();var s=0;if(this.table.page_size>0){for(var i=0;i<=this.table.total_records_count;i+=this.table.page_size){if(this.table.start_record==i){$('<option value="'+s+'" selected>'+(s+1)+"</option>").appendTo(this.page_selector)}else{$('<option value="'+s+'">'+(s+1)+"</option>").appendTo(this.page_selector)}s+=1}}else{$('<option value="0" selected>1</option>').appendTo(this.page_selector)}this.set_page_info()}set_page_info(){this.page_info.text(" "+this.table.lang.records+" [ "+(this.table.start_record+1)+"-"+(this.table.start_record+this.table.data.length)+" ] "+this.table.lang.from+" "+this.table.total_records_count+".")}build_pagination(elem){this.container=elem;var control_group=$('<div class="field has-addons" style="justify-content:center;"></div>').appendTo(this.container);$('<p class="control"><a class="button" title="'+this.table.lang.to_first_tooltip+'"><span class="icon"><span class="unicode-icon">⇤</span></span></a></p>').appendTo(control_group).click($.proxy(this.go_first,this));$('<p class="control"><a class="button" title="'+this.table.lang.to_prev_tooltip+'"><span class="icon"><span class="unicode-icon">←</span></span></a></p>').appendTo(control_group).click($.proxy(this.go_prev,this));var page_select=$('<div class="select control" title="'+this.table.lang.current_page_tooltip+'"></div>').appendTo(control_group);this.page_selector=$('<select style="border-radius:0px; margin-right:2px; margin-left:2px;"></select>').appendTo(page_select);this.page_selector.change($.proxy(this.page_change,this));$('<p class="control"><a class="button" title="'+this.table.lang.to_next_tooltip+'"><span class="icon"><span class="unicode-icon">→</span></span></a></p>').appendTo(control_group).click($.proxy(this.go_next,this));$('<p class="control"><a class="button" title="'+this.table.lang.to_last_tooltip+'"><span class="icon"><span class="unicode-icon">⇥</span></span></a></p>').appendTo(control_group).click($.proxy(this.go_last,this));$('<p class="control"><a class="button is-static">'+this.table.lang.on_one_page+"</a></p>").appendTo(control_group);var page_size_block=$('<div class="select control" title="'+this.table.lang.page_size_tooltip+'"><select  style="border-radius:0px; margin-right:2px; margin-left:2px;"></select></div>').appendTo(control_group);this.page_size_selector=page_size_block.children("select");var page_sizes=[5,10,25,50,100,0];var default_page_size=25;if(typeof this.options.page_sizes!="undefined"){page_sizes=this.options.page_sizes}if(typeof this.options.default_page_sizes!="undefined"){default_page_size=this.options.default_page_sizes}for(var i in page_sizes){var page_name=page_sizes[i];var selected="";if(page_sizes[i]==0){if(typeof this.options.hide_all_records!="undefined"&&this.options.hide_all_records==true){continue}page_name=this.table.lang.all_records}if(page_sizes[i]==default_page_size){selected="selected"}$('<option value="'+page_sizes[i]+'" '+selected+">"+page_name+"</option>").appendTo(this.page_size_selector)}this.page_size_selector.change($.proxy(this.page_size_change,this));this.page_info=$('<p class="control"><a class="button is-static"></a></p>').appendTo(control_group).children("a");this.page_info.text(" "+this.table.lang.records+" 0 "+this.table.lang.from+" 0 ")}}class CTable{constructor(options={}){this.options=options;this.table=$('<table class="table is-narrow is-bordered is-fullwidth is-hoverable ctable-table"></table>');this.colgroup=$("<colgroup></colgroup>").appendTo(this.table);this.thead=$("<thead></thead>").appendTo(this.table);this.tfoot=$("<tfoot></tfoot>").appendTo(this.table);this.tbody=$("<tbody></tbody>").appendTo(this.table);this.data=[];this.total_records_count=0;this.start_record=0;this.page_size=0;this.columns_classes=[];this.columns_options=[];this.record_class=null;this.record_options=null;this.head_record=null;this.body_records=[];this.foot_record=null;this.pagination_class=null;this.pagination_options=null;this.pagination=null;this.column_orders={};this.column_filters={};this.column_searches={};this.predefined_fields={};this.options_cache_data={};this.options_cache_calls={};this.elem=null;if(typeof this.options.error_handler=="undefined"){this.options.error_handler=function(error_text){alert(error_text)}}this.lang={};if(typeof this.options.lang=="undefined"){this.options.lang="en"}if(this.options.lang=="en"){this.lang.no_records="No records";this.lang.edit_cell="Edit";this.lang.delete_cell="Delete";this.lang.add_record="Add";this.lang.save_record="Save";this.lang.cancel="Cancel";this.lang.delete_confirm="Delete record?";this.lang.no_select="[Any]";this.lang.on_one_page="Show records";this.lang.records="Current page";this.lang.from="from";this.lang.all_records="All";this.lang.server_side_error="Server side error";this.lang.error="Error: ";this.lang.add_tooltip="Add record";this.lang.reload_tooltip="Reload table";this.lang.expand_tooltip="Open subtable";this.lang.sort_tooltip="Sort by this column";this.lang.edit_tooltip="Change record";this.lang.delete_tooltip="Delete record";this.lang.select_all_tooltip="Select all";this.lang.to_first_tooltip="To first page";this.lang.to_prev_tooltip="To previous page";this.lang.current_page_tooltip="This page";this.lang.to_next_tooltip="To next page";this.lang.to_last_tooltip="To last page";this.lang.page_size_tooltip="Records per page";this.lang.no_file="[No file]";this.lang.multiple="Files: ";this.lang.upload="Upload...";this.lang.export="Export..."}if(this.options.lang=="ru"){this.lang.no_records="Нет записей";this.lang.edit_cell="Правка";this.lang.delete_cell="Удалить";this.lang.add_record="Добавить";this.lang.save_record="Сохранить";this.lang.cancel="Отменить";this.lang.delete_confirm="Удалить запись?";this.lang.no_select="[Не выбран]";this.lang.on_one_page="Записей на странице:";this.lang.records="На текущей странице";this.lang.from="из";this.lang.all_records="Все";this.lang.server_side_error="Ошибка на стороне сервера";this.lang.error="Ошибка: ";this.lang.add_tooltip="Добавить запись";this.lang.reload_tooltip="Перезагрузить страницу";this.lang.expand_tooltip="Открыть подтаблицу";this.lang.sort_tooltip="Сортировать по этому столбцу";this.lang.edit_tooltip="Изменить запись";this.lang.delete_tooltip="Удалить запись";this.lang.select_all_tooltip="Выбрать все";this.lang.to_first_tooltip="На первую страницу";this.lang.to_prev_tooltip="На предыдущую страницу";this.lang.current_page_tooltip="Текущая страница";this.lang.to_next_tooltip="На следующую страницу";this.lang.to_last_tooltip="На последнюю страницу";this.lang.page_size_tooltip="Записей на страницу";this.lang.no_file="[Нет файла]";this.lang.multiple="Файлов: ";this.lang.upload="Загрузить...";this.lang.export="Экспортировать..."}if(typeof jQuery.datetimepicker!="undefined"){jQuery.datetimepicker.setLocale(this.options.lang)}}visible_columns(){var cont=0;for(var i in this.columns_options){if(typeof this.columns_options[i].visible_column!="undefined"&&this.columns_options[i].visible_column==false){cont+=0}else{cont+=1}}return cont}set_record_class(record_class,options){this.record_class=record_class;this.record_options=options}set_pagination_class(pagination_class,options){this.pagination_class=pagination_class;this.pagination_options=options}add_column_class(column_class,options){this.columns_classes.push(column_class);this.columns_options.push(options)}build_table(elem){this.elem=elem;this.table.appendTo(this.elem);this.head_record=new this.record_class(this,this.record_options);this.head_record.set_head(this.thead);this.head_record.set_colgroup(this.colgroup);this.head_record.build_header();this.foot_record=new this.record_class(this,this.record_options);this.foot_record.set_foot(this.tfoot);this.foot_record.build_footer();if(this.pagination_class!==null){this.pagination=new this.pagination_class(this,this.pagination_options);var pagination_cell=$("<div></div>");pagination_cell.appendTo(this.elem);this.pagination.build_pagination(pagination_cell)}if(this.data.length==0){$('<tr><td style="text-align:center;" colspan="'+this.visible_columns()+'">&nbsp;</td></tr>').appendTo(this.tbody)}}fill_table(){this.body_records=[];this.tbody.empty();if(this.data.length==0){$('<tr><td style="text-align:center;" colspan="'+this.visible_columns()+'">'+this.lang.no_records+"</td></tr>").appendTo(this.tbody);return}for(var i in this.data){this.body_records.push(new this.record_class(this,this.record_options));var data_row=$("<tr></tr>").appendTo(this.tbody);this.body_records[i].set_row(data_row);this.body_records[i].set_data_index(i);this.body_records[i].build_record()}if(this.pagination!=null){this.pagination.on_table_reloaded()}}selected_records(){var selected_records=[];this.body_records.forEach(function(record){if(record.is_selected()){selected_records.push(record)}});return selected_records}set_order(column,type){if(type==""){delete this.column_orders[column]}else{this.column_orders[column]=type}}set_search(column,value){if(value==""){delete this.column_searches[column]}else{this.column_searches[column]=value}}set_filter(column,value){if(value=="%any"){delete this.column_filters[column]}else{this.column_filters[column]=value}}add_predefined_field(column,value){this.predefined_fields[column]=value}loading_screen(state){if(state){if(this.elem.find(".ctable-progress").length!=0)return;var pos_tbody=this.tbody.offset();var width_tbody=this.tbody.width();var height_tbody=this.tbody.height();$('<div class="ctable-progress" style="top:'+pos_tbody.top+"px; left:"+pos_tbody.left+"px; width:"+width_tbody+"px; height:"+height_tbody+'px;" ><div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div></div>').appendTo($(this.elem))}else{this.elem.find(".ctable-progress").remove()}}select(){var self=this;this.data=[];var select_method="GET";if(typeof this.options.select_method!="undefined"){select_method=this.options.select_method}if(typeof this.options.clear_cache_on_select!="undefined"&&this.options.clear_cache_on_select){this.options_cache_data={};this.options_cache_calls={}}this.loading_screen(true);$.ajax({type:select_method,url:this.options.endpoint,data:{select:JSON.stringify({start:this.start_record,page:this.page_size,column_filters:this.column_filters,column_searches:this.column_searches,column_orders:this.column_orders})},dataType:"json"}).done(function(data){if(data.Result=="OK"){self.data=data.Records;self.total_records_count=data.TotalRecordCount;self.fill_table()}else{self.options.error_handler(self.lang.error+data.Message)}}).fail(function(xhr,status,error){self.options.error_handler(self.lang.server_side_error+":\n"+xhr.status+": "+xhr.statusText+"\n"+error)}).always(function(){self.loading_screen(false)})}download(format,name,header){var self=this;var select_method="GET";var query=JSON.stringify({start:this.start_record,page:this.page_size,column_filters:this.column_filters,column_searches:this.column_searches,column_orders:this.column_orders,format:format,name:name,header:header});window.open(this.options.endpoint+"?download="+query,"_blank")}insert(record){var self=this;var editor_data=record.editor_values();if(editor_data==null)return"invalid";var record_data=Object.assign({},editor_data,this.predefined_fields);this.loading_screen(true);$.ajax({type:"POST",url:this.options.endpoint,data:{insert:JSON.stringify(record_data)},dataType:"json"}).done(function(data){if(data.Result=="OK"){self.select()}else{self.options.error_handler(self.lang.error+data.Message);self.loading_screen(false)}},"json").fail(function(xhr,status,error){self.options.error_handler(self.lang.server_side_error+":\n"+xhr.status+": "+xhr.statusText+"\n"+error);self.loading_screen(false)})}update(record){var self=this;var updated_record_data=record.editor_values();if(updated_record_data==null)return"invalid";var record_data=Object.assign({},updated_record_data,this.predefined_fields);this.loading_screen(true);$.ajax({type:"POST",url:this.options.endpoint,data:{update:JSON.stringify(record_data)},dataType:"json"}).done(function(data){if(data.Result=="OK"){self.select()}else{self.options.error_handler(self.lang.error+data.Message);self.loading_screen(false)}},"json").fail(function(xhr,status,error){self.options.error_handler(self.lang.server_side_error+":\n"+xhr.status+": "+xhr.statusText+"\n"+error);self.loading_screen(false)})}remove(record){var self=this;var record_data=Object.assign({},self.data[record.data_index],this.predefined_fields);this.loading_screen(true);$.ajax({type:"POST",url:this.options.endpoint,data:{delete:JSON.stringify(record_data)},dataType:"json"}).done(function(data){if(data.Result=="OK"){self.select()}else{self.options.error_handler(self.lang.error+data.Message);self.loading_screen(false)}},"json").fail(function(xhr,status,error){self.options.error_handler(self.lang.server_side_error+":\n"+xhr.status+": "+xhr.statusText+"\n"+error);self.loading_screen(false)})}load_from_options_cache(endpoint,params,on_options_loaded){var str_params=endpoint+JSON.stringify(params);if(this.options_cache_data[str_params]!=undefined){on_options_loaded(this.options_cache_data[str_params]);return}if(this.options_cache_calls[str_params]!=undefined){this.options_cache_calls[str_params].push(on_options_loaded);return}this.options_cache_calls[str_params]=[on_options_loaded];var self=this;var query_endpoint=this.options.endpoint;if(typeof endpoint!="undefined"){query_endpoint=endpoint}var select_method="GET";if(typeof this.options.select_method!="undefined"){select_method=this.options.select_method}$.ajax({type:select_method,url:query_endpoint,data:{options:JSON.stringify(params)},dataType:"json"}).done(function(data){if(data.Result=="OK"){self.options_cache_data[str_params]=data.Options;if(typeof self.options_cache_calls[str_params]!="undefined"){self.options_cache_calls[str_params].forEach(function(callback){callback(self.options_cache_data[str_params])})}self.options_cache_calls[str_params]={}}else{self.options.error_handler(self.lang.error+data.Message)}},"json").fail(function(xhr,status,error){self.options.error_handler(self.lang.server_side_error+":\n"+xhr.status+": "+xhr.statusText+"\n"+error)})}custom(kind,handler,data,on_query_complete){var self=this;var custom_method="GET";if(typeof this.options.select_method!="undefined"){custom_method=this.options.select_method}if(kind=="write"){custom_method="POST"}var sended_array={};if(kind=="read"){sended_array={custom_read:JSON.stringify({handler:handler,data:data})}}else{sended_array={custom_write:JSON.stringify({handler:handler,data:data})}}this.loading_screen(true);$.ajax({type:custom_method,url:this.options.endpoint,data:sended_array,dataType:"json"}).done(function(data){if(data.Result=="OK"){on_query_complete(data.Records);self.loading_screen(false)}else{self.options.error_handler(self.lang.error+data.Message);self.loading_screen(false)}},"json").fail(function(xhr,status,error){self.options.error_handler(self.lang.server_side_error+":\n"+xhr.status+": "+xhr.statusText+"\n"+error);self.loading_screen(false)})}}