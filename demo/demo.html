<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>CTable Demo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.min.css"/>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="ctable.css"/>
    <script src="ctable.js"></script>
</head>
<body>

<a href="https://github.com/f0ma/ctable"  style="position:absolute;z-index:4;right:0;top:0;"><img width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149" alt="Fork me on GitHub"></a>

<div class="content" style="margin:15px;">

<h1>CTable CRUD demo page</h1>

<p>CTable is a JS library to make CRUD (CReate, Update, Delete) web tables.</p>

<p>Homepage: <a href="https://github.com/f0ma/ctable">https://github.com/f0ma/ctable</a> | Docs: <a href="https://f0ma.github.io/ctable/">https://f0ma.github.io/ctable/</a></p>

</div>



<div id="mainbox"></div>

<script>
$(function() {
    var t = new CTable({endpoint: "http://localhost:8000/demo.php?table=account"});
    t.set_record_class(CAdaptiveRecord, {non_adaptive_record: true});

    t.add_column_class(CCheckboxColumn, {});
    
    t.add_column_class(CSubtableColumn,{record_width_class: 'is-1', table: function(parent_record){
    
        var tt = new CTable({endpoint: "http://localhost:8000/demo.php?table=bill"});
    
        tt.set_record_class(CAdaptiveRecord, {non_adaptive_record: true});
        tt.add_column_class(CColumn,{column:'id', title:'ID', visible_editor:false});
        
        tt.add_column_class(CIndicatorColumn,{title:'Ok?',
                                      informer:function(record, column){if (record.record_field('state') == 3) {return 'ok';} return 'warning';},
                                      visible_editor:false});
        
        tt.add_column_class(CTextDataColumn,{column:'date',
                                      title:'Date',
                                      validate: "[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]",
                                      editor_width_class: 'is-2',
                                      footnote: 'in YYYY-MM-DD format'});

        tt.add_column_class(CTextDataColumn,{column:'sum',
                                      title:'Sum',
                                      validate: "[0-9]+",
                                      editor_width_class: 'is-2',
                                      render: function (elem, record, column){elem.text(record.record_field(column)+" $")}
                                      });

       tt.add_column_class(CSelectColumn,{column:'state',
                                          title:'State',
                                          options:[[1,'Created'],[2,'Processing'], [3,'Complete']],
                                          editor_width_class: 'is-2'});
                                      
        tt.set_filter('account_id', parent_record.record_field('id'));
        tt.add_predefined_field('account_id', parent_record.record_field('id'));
        
        tt.add_column_class(CCommandColumn,{title:'Actions', editor_width_class: 'is-2'});
        
        return tt;
    }});
    
    t.add_column_class(CColumn,{column:'id',
                                title:'ID',
                                visible_editor:false,
                                visible_column:true});

    t.add_column_class(CTextDataColumn,{column:'firstname',
                                        title:'Firstname',
                                        validate:"\\S+", editor_width_class: 'is-3'});
    
    t.add_column_class(CTextDataColumn,{column:'lastname',
                                        title:'Lastname',
                                        validate:"\\S+", editor_width_class: 'is-3'});
    
    t.add_column_class(CTextDataColumn,{column:'reg_date',
                                      title:'Registration date',
                                      validate: "[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]",
                                      editor_width_class: 'is-2',
                                      footnote: 'in YYYY-MM-DD format'});
    
    t.add_column_class(CSelectColumn,{column:'status',
                                      title:'Status',
                                      options:[[0,'Unknown'],[1,'OK'], [2,'Blocked']],
                                      editor_width_class: 'is-2'});
    
    t.add_column_class(CCommandColumn,{title:'Actions', editor_width_class: 'is-2',
                                            common_actions: [{action: function(record){
                                                                  var textline = "Selected ID: ";
                                                                  record.table.selected_records().forEach(function(item){
                                                                      textline+=item.record_field('id')+" ";
                                                                  });
                                                                  alert(textline);
                                                              },
                                                              tooltip: "Show selected records"}]});
    
    t.set_pagination_class(CPagination,{});
    
    t.build_table($('#mainbox'));
    
    t.select();
    
    

});
</script>
</body>
